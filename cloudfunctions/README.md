# 云函数目录

本目录包含微信小程序的云函数代码。

## 目录结构

```
cloudfunctions/
├── extractWords/          # 单词提取云函数
│   ├── index.js          # 主函数文件
│   ├── package.json      # 依赖配置
│   ├── config.json       # 环境变量配置
│   └── README.md         # 详细使用说明
└── README.md             # 本文件
```

## 云函数列表

### 1. extractWords - 单词提取云函数

基于阿里千问OCR能力的英文单词提取云函数，用于从图片中识别并提取英文单词。

**功能特性：**
- 🔍 智能识别：基于阿里千问最新OCR模型
- 📝 单词提取：专门提取英文单词，过滤中文和数字
- 🔄 自动旋转：支持图片自动旋转识别
- ❓ 模糊处理：模糊字母用?代替
- 🚫 去重处理：自动去除重复单词

## 部署步骤

### 1. 开通云开发

1. 在微信开发者工具中打开项目
2. 点击工具栏中的"云开发"按钮
3. 按照提示开通云开发服务
4. 创建云开发环境

### 2. 配置环境变量

1. 获取阿里千问API密钥：
   - 访问 [阿里云百炼平台](https://bailian.console.aliyun.com/)
   - 注册并实名认证
   - 创建应用并获取API Key

2. 在微信开发者工具中配置：
   - 右键点击 `extractWords` 云函数
   - 选择"配置"
   - 在环境变量中添加：`DASHSCOPE_API_KEY = 你的API密钥`

### 3. 安装依赖并部署

1. 在云函数目录下安装依赖：
   ```bash
   cd cloudfunctions/extractWords
   npm install
   ```

2. 部署云函数：
   - 右键点击 `extractWords` 云函数
   - 选择"上传并部署：云端安装依赖"

### 4. 测试云函数

在小程序中调用云函数进行测试：

```javascript
wx.cloud.callFunction({
  name: 'extractWords',
  data: {
    imageUrl: 'https://example.com/test-image.jpg',
    imageType: 'url'
  },
  success: res => {
    console.log('测试结果:', res.result)
  },
  fail: err => {
    console.error('测试失败:', err)
  }
})
```

## 注意事项

1. **API配额限制**：阿里千问OCR有调用次数限制，请合理使用
2. **网络要求**：云函数需要访问外网调用阿里云API
3. **图片要求**：
   - 支持常见图片格式（JPG、PNG等）
   - 建议图片清晰度适中
   - 文字内容清晰可见
4. **成本控制**：建议设置合理的调用频率限制

## 故障排除

### 常见错误

1. **未配置DASHSCOPE_API_KEY环境变量**
   - 检查云函数配置中的环境变量设置

2. **API请求失败: 401**
   - API密钥无效或过期，请重新获取

3. **请求超时**
   - 图片过大或网络问题，建议压缩图片

4. **OCR识别失败**
   - 图片质量问题或格式不支持

### 调试方法

1. 查看云函数日志：
   - 在微信开发者工具中点击"云开发"
   - 进入"云函数"页面
   - 查看函数调用日志

2. 本地测试：
   - 可以在本地环境测试API调用
   - 确保网络连接正常

## 更新日志

- v1.0.0 (2024-01-XX)：初始版本，支持基础单词提取功能 