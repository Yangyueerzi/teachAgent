<view class="profile-container">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-section" wx:if="{{userInfo}}">
    <view class="user-card">
      <!-- ç¼–è¾‘æŒ‰é’® -->
      <view class="edit-profile-btn" bind:tap="editProfile">
        <text class="edit-icon">âœï¸</text>
      </view>
      
      <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ - å±…ä¸­å¸ƒå±€ -->
      <view class="user-basic-info">
        <t-avatar 
          size="large" 
          image="{{userInfo.avatarUrl || ''}}"
          class="user-avatar"
        >
          {{userInfo.nickName ? userInfo.nickName.charAt(0) : 'ç”¨'}}
        </t-avatar>
        <view class="user-name">{{userInfo.nickName || 'ç”¨æˆ·'}}</view>
        <view class="user-desc">{{userInfo.grade || 'å°å­¦ç”Ÿ'}}</view>
      </view>
      
      <!-- ç”¨æˆ·ç»Ÿè®¡æ•°æ® -->
      <view class="user-stats">
        <view class="stat-item">
          <view class="stat-number">{{studyStats.totalPractices}}</view>
          <view class="stat-label">ç»ƒä¹ æ¬¡æ•°</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{studyStats.averageAccuracy}}%</view>
          <view class="stat-label">å¹³å‡æ­£ç¡®ç‡</view>
        </view>
        <view class="stat-item">
          <view class="stat-number">{{studyStats.masteredWords}}</view>
          <view class="stat-label">æŒæ¡å•è¯</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-section" wx:else>
    <view class="login-card">
      <view class="login-icon">ğŸ‘¤</view>
      <view class="login-title">æ¬¢è¿ä½¿ç”¨è¾…å¯¼åŠ©æ‰‹</view>
      <view class="login-desc">ç™»å½•åå¯æŸ¥çœ‹å­¦ä¹ è®°å½•å’Œé”™è¯¯å•è¯æœ¬</view>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="goToLogin"
        class="login-btn"
      >
        ç«‹å³ç™»å½•
      </t-button>
    </view>
  </view>

  <!-- å­¦ä¹ è®°å½• -->
  <view class="records-section" wx:if="{{userInfo && studyRecords.length > 0}}">
    <view class="section-title">æœ€è¿‘ç»ƒä¹ è®°å½•</view>
    <t-cell-group>
      <t-cell 
        wx:for="{{studyRecords}}" 
        wx:key="index"
        title="{{item.title}}"
        description="{{item.description}}"
        bind:click="viewRecord"
        data-index="{{index}}"
      >
        <view slot="right-icon" class="cell-arrow">></view>
        <view slot="note" class="record-score">
          <view class="score-text">{{item.accuracy}}%</view>
          <view class="score-label">æ­£ç¡®ç‡</view>
        </view>
      </t-cell>
    </t-cell-group>
  </view>

  <!-- é”™è¯¯å•è¯æœ¬ -->
  <view class="wrong-words-section" wx:if="{{userInfo && wrongWordsList.length > 0}}">
    <view class="section-title">é”™è¯¯å•è¯æœ¬ ({{wrongWordsList.length}}ä¸ª)</view>
    <t-cell-group>
      <t-cell 
        wx:for="{{wrongWordsList}}" 
        wx:key="index"
        title="{{item.word}}"
        description="é”™è¯¯æ¬¡æ•°: {{item.errorCount}}æ¬¡"
        bind:click="practiceWrongWord"
        data-word="{{item.word}}"
      >
        <view slot="right-icon" class="cell-arrow">></view>
        <view slot="left-icon">
          <t-tag 
            size="small" 
            theme="{{item.status === 'mastered' ? 'success' : 'warning'}}"
            variant="light"
          >
            {{item.status === 'mastered' ? 'å·²æŒæ¡' : 'éœ€å¤ä¹ '}}
          </t-tag>
        </view>
      </t-cell>
    </t-cell-group>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section" wx:if="{{userInfo}}">
    <t-cell-group>
      <t-cell 
        title="å­¦ä¹ ç»Ÿè®¡" 
        bind:click="viewStatistics"
      >
        <view slot="left-icon" class="menu-icon">ğŸ“Š</view>
        <view slot="right-icon" class="cell-arrow">></view>
      </t-cell>
      <t-cell 
        title="è®¾ç½®" 
        bind:click="openSettings"
      >
        <view slot="left-icon" class="menu-icon">âš™ï¸</view>
        <view slot="right-icon" class="cell-arrow">></view>
      </t-cell>
      <t-cell 
        title="å¸®åŠ©ä¸åé¦ˆ" 
        bind:click="openHelp"
      >
        <view slot="left-icon" class="menu-icon">â“</view>
        <view slot="right-icon" class="cell-arrow">></view>
      </t-cell>
      <t-cell 
        title="é€€å‡ºç™»å½•" 
        bind:click="logout"
      >
        <view slot="left-icon" class="menu-icon">ğŸšª</view>
        <view slot="right-icon" class="cell-arrow">></view>
      </t-cell>
    </t-cell-group>
  </view>
</view>

<!-- ç”¨æˆ·ä¿¡æ¯ç¼–è¾‘å¼¹çª— -->
<t-popup 
  visible="{{showEditModal}}" 
  bind:visible-change="onEditModalChange"
  placement="center"
  show-overlay="{{true}}"
  class="edit-modal"
>
  <view class="edit-modal-content">
    <view class="edit-modal-header">
      <view class="edit-modal-title">ç¼–è¾‘ä¸ªäººä¿¡æ¯</view>
      <view class="edit-modal-close" bind:tap="closeEditModal">âœ•</view>
    </view>
    
    <view class="edit-form">
      <!-- å¤´åƒç¼–è¾‘ -->
      <view class="edit-item">
        <view class="edit-label">å¤´åƒ</view>
        <view class="avatar-edit" bind:tap="chooseAvatar">
          <t-avatar 
            size="large" 
            image="{{editUserInfo.avatarUrl || ''}}"
            class="edit-avatar"
          >
            {{editUserInfo.nickName ? editUserInfo.nickName.charAt(0) : 'ç”¨'}}
          </t-avatar>
          <view class="avatar-edit-tip">ç‚¹å‡»æ›´æ¢å¤´åƒ</view>
        </view>
      </view>
      
      <!-- æ˜µç§°ç¼–è¾‘ -->
      <view class="edit-item">
        <view class="edit-label">æ˜µç§°</view>
        <t-input 
          value="{{editUserInfo.nickName}}"
          placeholder="è¯·è¾“å…¥æ˜µç§°"
          bind:change="onNickNameChange"
          maxlength="20"
          class="edit-input"
        />
      </view>
      
      <!-- å­¦å¹´ç¼–è¾‘ -->
      <view class="edit-item">
        <view class="edit-label">å­¦å¹´</view>
        <t-picker 
          value="{{editUserInfo.grade}}"
          data-key="grade"
          options="{{gradeOptions}}"
          bind:change="onGradeChange"
          class="edit-picker"
        >
          <t-input 
            value="{{editUserInfo.grade}}"
            placeholder="è¯·é€‰æ‹©å­¦å¹´"
            readonly
            suffix-icon="chevron-down"
            class="edit-input"
          />
        </t-picker>
      </view>
    </view>
    
    <view class="edit-modal-buttons">
      <t-button 
        theme="default" 
        size="large"
        bind:tap="closeEditModal"
        class="modal-btn"
      >
        å–æ¶ˆ
      </t-button>
      <t-button 
        theme="primary" 
        size="large"
        bind:tap="saveUserInfo"
        class="modal-btn"
      >
        ä¿å­˜
      </t-button>
    </view>
  </view>
</t-popup>

<!-- Toast ç»„ä»¶ -->
<t-toast id="t-toast" /> 