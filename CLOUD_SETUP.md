# 云开发配置指南

## 问题解决

如果遇到以下错误：
- `cloud Api is not enabled` - 云开发服务未开通
- 无法预览照片 - 可能是图片路径或组件问题
- 云函数调用失败 - 环境ID配置错误

## 配置步骤

### 1. 开通云开发服务

1. 在微信开发者工具中打开项目
2. 点击工具栏中的"云开发"按钮
3. 点击"开通"按钮
4. 选择套餐（建议选择免费套餐）
5. 填写环境名称（如：teachagent-prod）
6. 等待环境创建完成

### 2. 获取云环境ID

1. 在云开发控制台中，点击左上角的环境名称
2. 复制环境ID（格式类似：cloud1-8g0qhqhm8b8b8b8b）
3. 记录这个ID，稍后需要用到

### 3. 配置小程序云环境ID

1. 打开 `miniprogram/app.ts` 文件
2. 找到以下代码：
   ```typescript
   wx.cloud.init({
     env: 'cloud1-8g0qhqhm8b8b8b8b', // 请替换为你的云环境ID
     traceUser: true,
   })
   ```
3. 将 `cloud1-8g0qhqhm8b8b8b8b` 替换为你的实际云环境ID

### 4. 配置云函数环境变量

1. 获取阿里千问API密钥：
   - 访问 [阿里云百炼平台](https://bailian.console.aliyun.com/)
   - 注册并完成实名认证
   - 创建应用并获取API Key

2. 在微信开发者工具中：
   - 右键点击 `cloudfunctions/extractWords` 文件夹
   - 选择"配置"
   - 在环境变量中添加：
     ```
     DASHSCOPE_API_KEY = sk-xxxxxxxxxxxxxxxxx
     ```

### 5. 部署云函数

1. 右键点击 `cloudfunctions/extractWords` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 6. 测试功能

1. 在小程序中尝试拍照上传功能
2. 查看控制台日志确认云开发初始化成功
3. 测试OCR识别功能

## 常见问题

### Q: 提示"cloud Api is not enabled"
A: 说明云开发服务未正确开通或环境ID配置错误
- 检查是否已开通云开发服务
- 确认环境ID是否正确配置

### Q: 图片无法预览
A: 可能是以下原因：
- 图片路径问题
- TDesign组件版本问题
- 小程序基础库版本过低

### Q: 云函数调用失败
A: 检查以下配置：
- 云函数是否正确部署
- 环境变量是否正确设置
- API密钥是否有效

### Q: OCR识别失败
A: 可能的原因：
- API密钥无效或过期
- 网络连接问题
- 图片格式不支持
- API调用次数超限

## 环境ID示例

正确的环境ID格式：
- `cloud1-8g0qhqhm8b8b8b8b`
- `prod-4g5h6j7k8l9m0n1p`
- `test-1a2b3c4d5e6f7g8h`

错误的格式：
- `我的云环境` (中文名称)
- `teachagent-prod` (环境名称，不是ID)

## 联系支持

如果按照以上步骤仍然无法解决问题，请：
1. 检查微信开发者工具版本（建议使用最新版）
2. 查看云开发控制台的错误日志
3. 确认小程序基础库版本（建议2.2.3以上） 