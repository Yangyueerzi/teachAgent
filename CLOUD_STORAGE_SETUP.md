# 微信小程序云存储配置指南

## 问题分析

根据错误信息：`env check invalid be filterd (ec0f7a5d-941f-4c7e-90c3-a2a76f4567f7)`

这表明：
1. 你的真实环境ID是：`ec0f7a5d-941f-4c7e-90c3-a2a76f4567f7`
2. 但代码中配置的是：`cloud1-0g9l5ytxf45e113f`
3. 环境ID不匹配导致云存储访问失败

## 解决步骤

### 步骤1: 修正环境ID配置

1. **打开 `miniprogram/app.ts` 文件**
2. **找到第16行**：
   ```typescript
   env: 'cloud1-0g9l5ytxf45e113f', // 请替换为你的云环境ID
   ```
3. **替换为正确的环境ID**：
   ```typescript
   env: 'ec0f7a5d-941f-4c7e-90c3-a2a76f4567f7', // 你的真实环境ID
   ```

### 步骤2: 开通云存储服务

#### 2.1 进入云开发控制台
1. 在微信开发者工具中点击 **"云开发"** 按钮
2. 进入云开发控制台

#### 2.2 开通云存储
1. 在左侧菜单中点击 **"存储"**
2. 如果显示"开通存储"按钮，点击开通
3. 选择存储套餐（建议选择免费套餐）
4. 等待开通完成

#### 2.3 配置存储权限
1. 在存储页面点击 **"设置"** 标签
2. 配置读写权限：
   - **读权限**：选择 "所有用户可读"
   - **写权限**：选择 "仅创建者可写" 或 "所有用户可写"
3. 点击 **"保存"**

### 步骤3: 验证云存储配置

#### 3.1 检查存储状态
1. 在云开发控制台的存储页面
2. 确认状态显示为 **"正常"**
3. 查看存储容量和使用情况

#### 3.2 测试存储功能
1. 在存储页面点击 **"上传文件"**
2. 尝试手动上传一个测试文件
3. 确认上传成功

### 步骤4: 配置云函数环境

#### 4.1 部署云函数
1. 右键点击 `cloudfunctions/extractWords` 文件夹
2. 选择 **"上传并部署：云端安装依赖"**
3. 等待部署完成

#### 4.2 配置环境变量
1. 右键点击 `cloudfunctions/extractWords` 文件夹
2. 选择 **"配置"**
3. 在环境变量中添加：
   ```
   DASHSCOPE_API_KEY = sk-xxxxxxxxxxxxxxxxx
   ```
4. 点击 **"确定"**

### 步骤5: 测试完整功能

#### 5.1 重新编译小程序
1. 保存所有修改的文件
2. 重新编译小程序

#### 5.2 测试上传功能
1. 在小程序中进入拍照上传页面
2. 选择或拍摄一张图片
3. 点击 **"确认上传"**
4. 观察控制台日志

## 常见问题解决

### Q1: 环境ID在哪里查看？
**A**: 在云开发控制台左上角，环境名称下方显示的就是环境ID

### Q2: 存储开通失败怎么办？
**A**: 
1. 检查微信开发者账号是否已实名认证
2. 确认小程序已发布或在开发版本中
3. 重试开通流程

### Q3: 上传仍然失败怎么办？
**A**: 
1. 检查网络连接
2. 确认环境ID配置正确
3. 查看云开发控制台的错误日志

### Q4: 云函数调用失败怎么办？
**A**: 
1. 确认云函数已正确部署
2. 检查环境变量配置
3. 查看云函数日志

## 配置检查清单

完成以下检查确保配置正确：

- [ ] 环境ID已正确配置为：`ec0f7a5d-941f-4c7e-90c3-a2a76f4567f7`
- [ ] 云存储服务已开通
- [ ] 存储权限已正确配置
- [ ] 云函数已成功部署
- [ ] API密钥已正确配置
- [ ] 小程序重新编译
- [ ] 上传功能测试通过

## 完整的 app.ts 配置示例

```typescript
// app.ts
App<IAppOption>({
  globalData: {
    userInfo: null,
    systemInfo: null
  },

  onLaunch() {
    // 初始化云开发
    if (wx.cloud) {
      wx.cloud.init({
        env: 'ec0f7a5d-941f-4c7e-90c3-a2a76f4567f7', // 你的真实环境ID
        traceUser: true,
      })
      console.log('云开发初始化成功')
    } else {
      console.error('请使用 2.2.3 或以上的基础库以使用云能力')
    }
    
    // ... 其他代码保持不变
  }
})
```

## 紧急解决方案

如果按照上述步骤仍然有问题，可以尝试：

1. **使用默认环境**：
   ```typescript
   wx.cloud.init({
     // 不指定env，使用默认环境
     traceUser: true,
   })
   ```

2. **重新创建云环境**：
   - 在云开发控制台创建新的环境
   - 使用新环境的ID

3. **联系技术支持**：
   - 访问：https://tcb.cloud.tencent.com/dev#/helper/copilot
   - 提供错误信息寻求帮助 